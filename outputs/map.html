<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Concordia 2 (C2) | NUST Navigator</title>
    <link href="https://fonts.googleapis.com/css2?family=Quicksand:wght@400;500;600;700&family=Noto+Sans:wght@400;500;600&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons+Round" rel="stylesheet">
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDjkvqozp-7DoEnMVS7kv1Rl4I80gDxjtc"></script>
    <style>
        :root {
            --sakura-50: #FFF5F7;
            --sakura-100: #FFEEF2;
            --sakura-200: #FFD6E0;
            --sakura-300: #FFB7C5;
            --sakura-400: #FF8FA3;
            --sakura-500: #E75480;
            --sakura-600: #C44569;
            --brown-800: #5D3A4B;
            --brown-900: #3D2533;
            --cream: #FFFBFC;
            --shadow-soft: 0 4px 20px rgba(93, 58, 75, 0.12);
            --shadow-medium: 0 8px 30px rgba(93, 58, 75, 0.18);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: 'Noto Sans', sans-serif;
            background: var(--sakura-50);
            color: var(--brown-800);
            overflow: hidden;
        }

        /* ========== CHERRY BLOSSOM PETALS ========== */
        .petal {
            position: fixed;
            width: 10px;
            height: 10px;
            background: var(--sakura-300);
            border-radius: 150% 0 150% 0;
            opacity: 0;
            pointer-events: none;
            z-index: 9999;
            animation: fall linear infinite;
        }
        .petal:nth-child(odd) { background: var(--sakura-200); }
        .petal:nth-child(3n) { background: var(--sakura-400); width: 8px; height: 8px; }

        @keyframes fall {
            0% { opacity: 0; transform: translateX(0) translateY(-10vh) rotate(0deg); }
            10% { opacity: 0.9; }
            90% { opacity: 0.9; }
            100% { opacity: 0; transform: translateX(80px) translateY(105vh) rotate(540deg); }
        }

        /* ========== START PAGE ========== */
        .start-page {
            position: fixed;
            inset: 0;
            background: linear-gradient(135deg, var(--sakura-100) 0%, var(--sakura-50) 50%, var(--cream) 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            transition: opacity 0.5s ease, transform 0.5s ease;
        }
        .start-page.hidden {
            opacity: 0;
            transform: scale(1.02);
            pointer-events: none;
        }

        .start-card {
            background: white;
            border-radius: 20px;
            padding: 40px 44px;
            max-width: 480px;
            width: 90%;
            box-shadow: var(--shadow-medium);
            text-align: center;
            position: relative;
            overflow: hidden;
        }
        .start-card::before {
            content: '';
            position: absolute;
            top: 0; left: 0; right: 0;
            height: 5px;
            background: linear-gradient(90deg, var(--sakura-300), var(--sakura-500), var(--sakura-300));
        }

        .brand {
            font-family: 'Quicksand', sans-serif;
            font-size: 12px;
            font-weight: 600;
            color: var(--sakura-500);
            text-transform: uppercase;
            letter-spacing: 2.5px;
            margin-bottom: 6px;
        }
        .start-title {
            font-family: 'Quicksand', sans-serif;
            font-size: 24px;
            font-weight: 700;
            color: var(--brown-900);
            margin-bottom: 28px;
        }

        .route-visual {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            margin-bottom: 28px;
            padding: 20px;
            background: var(--sakura-50);
            border-radius: 14px;
        }
        .location-badge {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 6px;
        }
        .location-dot {
            width: 42px;
            height: 42px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
            font-size: 16px;
        }
        .location-dot.start { background: linear-gradient(135deg, #10B981, #059669); }
        .location-dot.end { background: linear-gradient(135deg, var(--sakura-500), var(--sakura-600)); }
        .location-name {
            font-size: 12px;
            font-weight: 500;
            color: var(--brown-800);
            max-width: 100px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }
        .route-line {
            flex: 1;
            height: 3px;
            background: linear-gradient(90deg, #10B981, var(--sakura-500));
            border-radius: 2px;
            position: relative;
            max-width: 100px;
        }
        .route-line::after {
            content: '';
            position: absolute;
            right: -5px;
            top: 50%;
            transform: translateY(-50%);
            border: 5px solid transparent;
            border-left-color: var(--sakura-500);
        }

        .quick-stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 12px;
            margin-bottom: 24px;
        }
        .quick-stat {
            padding: 14px 8px;
            background: var(--sakura-50);
            border-radius: 10px;
        }
        .quick-stat-value {
            font-family: 'Quicksand', sans-serif;
            font-size: 22px;
            font-weight: 700;
            color: var(--brown-900);
        }
        .quick-stat-label {
            font-size: 11px;
            color: var(--brown-800);
            opacity: 0.7;
            margin-top: 2px;
        }

        .mode-badge {
            display: inline-flex;
            align-items: center;
            gap: 5px;
            padding: 6px 14px;
            background: var(--sakura-100);
            border-radius: 16px;
            font-size: 12px;
            font-weight: 500;
            color: var(--sakura-600);
            margin-bottom: 20px;
        }
        .mode-badge .material-icons-round { font-size: 16px; }

        .explore-btn {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 14px 36px;
            background: linear-gradient(135deg, var(--sakura-500), var(--sakura-600));
            color: white;
            border: none;
            border-radius: 50px;
            font-family: 'Quicksand', sans-serif;
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            box-shadow: 0 4px 15px rgba(231, 84, 128, 0.3);
        }
        .explore-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(231, 84, 128, 0.4);
        }
        .explore-btn .material-icons-round { font-size: 18px; }

        .generated-time {
            font-size: 10px;
            color: var(--brown-800);
            opacity: 0.4;
            margin-top: 20px;
        }

        /* ========== MAP VIEW ========== */
        .map-view {
            position: fixed;
            inset: 0;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.5s ease;
        }
        .map-view.active {
            opacity: 1;
            pointer-events: auto;
        }
        #map { width: 100%; height: 100%; }

        /* ========== FIXED: Panel Container with proper spacing ========== */
        .panel-container {
            position: fixed;
            top: 24px;           /* FIXED: More top padding */
            right: 20px;
            bottom: 50px;        /* FIXED: Space for Google attribution */
            width: 300px;        /* FIXED: Slightly narrower */
            display: flex;
            flex-direction: column;
            gap: 10px;
            overflow-y: auto;
            overflow-x: hidden;
            padding-right: 6px;
            padding-bottom: 10px;
            z-index: 100;
        }
        
        /* FIXED: Visible scrollbar styling */
        .panel-container::-webkit-scrollbar {
            width: 5px;
        }
        .panel-container::-webkit-scrollbar-track {
            background: rgba(255,255,255,0.3);
            border-radius: 3px;
        }
        .panel-container::-webkit-scrollbar-thumb {
            background: var(--sakura-400);
            border-radius: 3px;
        }
        .panel-container::-webkit-scrollbar-thumb:hover {
            background: var(--sakura-500);
        }

        /* Scroll fade indicator at bottom */
        .panel-container::after {
            content: '';
            position: sticky;
            bottom: 0;
            left: 0;
            right: 0;
            height: 20px;
            background: linear-gradient(transparent, rgba(255,255,255,0.8));
            pointer-events: none;
            flex-shrink: 0;
        }

        .panel {
            background: white;
            border-radius: 14px;
            box-shadow: var(--shadow-soft);
            overflow: hidden;
            flex-shrink: 0;
        }

        .panel-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 12px 14px;
            background: var(--sakura-50);
            cursor: pointer;
            user-select: none;
            transition: background 0.2s;
        }
        .panel-header:hover { background: var(--sakura-100); }
        
        .panel-title {
            display: flex;
            align-items: center;
            gap: 8px;
            font-family: 'Quicksand', sans-serif;
            font-weight: 600;
            font-size: 13px;
            color: var(--brown-900);
        }
        .panel-title .material-icons-round {
            font-size: 18px;
            color: var(--sakura-500);
        }
        .panel-toggle {
            color: var(--brown-800);
            opacity: 0.5;
            transition: transform 0.3s;
            font-size: 20px;
        }
        .panel.collapsed .panel-toggle { transform: rotate(-90deg); }

        .panel-content {
            padding: 14px;
            display: grid;
            gap: 10px;
            max-height: 300px;
            overflow: hidden;
            transition: max-height 0.3s ease, padding 0.3s ease, opacity 0.3s ease;
        }
        .panel.collapsed .panel-content {
            max-height: 0;
            padding-top: 0;
            padding-bottom: 0;
            opacity: 0;
        }

        /* Stats Grid */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 8px;
        }
        .stat-item {
            padding: 10px;
            background: var(--sakura-50);
            border-radius: 8px;
            text-align: center;
        }
        .stat-value {
            font-family: 'Quicksand', sans-serif;
            font-size: 18px;
            font-weight: 700;
            color: var(--brown-900);
        }
        .stat-label {
            font-size: 10px;
            color: var(--brown-800);
            opacity: 0.7;
            margin-top: 2px;
        }

        /* Algorithm Card */
        .algo-card {
            padding: 12px;
            background: linear-gradient(135deg, var(--sakura-100), var(--sakura-50));
            border-radius: 8px;
            border-left: 3px solid var(--sakura-500);
        }
        .algo-name {
            font-family: 'Quicksand', sans-serif;
            font-weight: 700;
            font-size: 14px;
            color: var(--brown-900);
            margin-bottom: 6px;
        }
        .algo-stats {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }
        .algo-stat {
            font-size: 11px;
            color: var(--brown-800);
        }
        .algo-stat strong { color: var(--sakura-600); }

        /* POI List */
        .poi-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 10px;
            background: var(--sakura-50);
            border-radius: 6px;
        }
        .poi-name {
            font-size: 12px;
            font-weight: 500;
            color: var(--brown-800);
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
            max-width: 180px;
        }
        .poi-distance {
            font-size: 11px;
            font-weight: 600;
            color: var(--sakura-600);
            flex-shrink: 0;
        }

        /* Fun Stats */
        .fun-stat {
            padding: 8px 12px;
            background: linear-gradient(135deg, #FEF3C7, #FDE68A);
            border-radius: 6px;
            font-size: 12px;
            color: #92400E;
            border-left: 3px solid #F59E0B;
        }

        /* FIXED: Elevation Chart with proper padding */
        .elevation-chart {
            height: 70px;
            background: var(--sakura-50);
            border-radius: 8px;
            padding: 12px 10px 8px 10px;  /* FIXED: More padding */
            position: relative;
        }
        .elevation-svg {
            width: 100%;
            height: 100%;
            overflow: visible;
        }
        .elevation-path {
            fill: none;
            stroke: var(--sakura-500);
            stroke-width: 2;
            stroke-linecap: round;
            stroke-linejoin: round;
        }
        .elevation-fill {
            fill: url(#elevationGradient);
            opacity: 0.4;
        }
        .elevation-labels {
            display: flex;
            justify-content: space-between;
            font-size: 9px;
            color: var(--brown-800);
            opacity: 0.5;
            margin-top: 4px;
        }

        /* FIXED: Control buttons group on left side */
        .left-controls {
            position: fixed;
            top: 24px;
            left: 20px;
            display: flex;
            flex-direction: column;
            gap: 10px;
            z-index: 100;
        }

        .control-btn {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 10px 16px;
            background: white;
            border: none;
            border-radius: 50px;
            font-family: 'Quicksand', sans-serif;
            font-size: 13px;
            font-weight: 600;
            color: var(--brown-800);
            cursor: pointer;
            box-shadow: var(--shadow-soft);
            transition: transform 0.2s, box-shadow 0.2s;
        }
        .control-btn:hover {
            transform: translateY(-1px);
            box-shadow: var(--shadow-medium);
        }
        .control-btn .material-icons-round { font-size: 18px; }
        
        .control-btn.active {
            background: var(--sakura-500);
            color: white;
        }

        /* Map Type Selector Group */
        .map-type-group {
            display: flex;
            background: white;
            border-radius: 12px;
            padding: 4px;
            box-shadow: var(--shadow-soft);
            gap: 2px;
        }
        .map-type-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 40px;
            height: 40px;
            background: transparent;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            color: var(--brown-800);
            transition: all 0.2s;
        }
        .map-type-btn:hover {
            background: var(--sakura-100);
        }
        .map-type-btn.active {
            background: var(--sakura-500);
            color: white;
        }
        .map-type-btn .material-icons-round {
            font-size: 20px;
        }

        /* POI Filter Popup */
        .poi-filter-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(139, 69, 79, 0.3);
            backdrop-filter: blur(4px);
            z-index: 500;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }
        .poi-filter-overlay.active {
            opacity: 1;
            visibility: visible;
        }
        
        .poi-filter-popup {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) scale(0.9);
            background: linear-gradient(135deg, #FFF5F7 0%, #FFFFFF 100%);
            border-radius: 24px;
            padding: 0;
            width: 360px;
            max-height: 70vh;
            box-shadow: 0 25px 50px -12px rgba(139, 69, 79, 0.25);
            z-index: 501;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
            overflow: hidden;
        }
        .poi-filter-popup.active {
            opacity: 1;
            visibility: visible;
            transform: translate(-50%, -50%) scale(1);
        }
        
        .poi-popup-header {
            background: linear-gradient(135deg, var(--sakura-500) 0%, var(--sakura-600) 100%);
            padding: 20px 24px;
            position: relative;
            overflow: hidden;
        }
        .poi-popup-header::before {
            content: 'üå∏';
            position: absolute;
            top: -10px;
            right: 20px;
            font-size: 60px;
            opacity: 0.2;
        }
        .poi-popup-header h3 {
            margin: 0;
            font-family: 'Quicksand', sans-serif;
            font-size: 18px;
            font-weight: 700;
            color: white;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .poi-popup-header p {
            margin: 6px 0 0 0;
            font-size: 12px;
            color: rgba(255,255,255,0.8);
        }
        .poi-popup-close {
            position: absolute;
            top: 16px;
            right: 16px;
            width: 32px;
            height: 32px;
            border-radius: 50%;
            border: none;
            background: rgba(255,255,255,0.2);
            color: white;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
        }
        .poi-popup-close:hover {
            background: rgba(255,255,255,0.3);
            transform: rotate(90deg);
        }
        
        .poi-popup-actions {
            display: flex;
            gap: 8px;
            padding: 16px 20px;
            background: var(--sakura-50);
            border-bottom: 1px solid var(--sakura-100);
        }
        .poi-action-btn {
            flex: 1;
            padding: 10px 16px;
            border: 2px solid var(--sakura-300);
            border-radius: 12px;
            background: white;
            font-family: 'Quicksand', sans-serif;
            font-size: 12px;
            font-weight: 600;
            color: var(--sakura-600);
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
        }
        .poi-action-btn:hover {
            background: var(--sakura-500);
            border-color: var(--sakura-500);
            color: white;
        }
        .poi-action-btn .material-icons-round {
            font-size: 16px;
        }
        
        .poi-popup-list {
            padding: 12px 16px;
            max-height: 320px;
            overflow-y: auto;
        }
        .poi-popup-list::-webkit-scrollbar {
            width: 6px;
        }
        .poi-popup-list::-webkit-scrollbar-track {
            background: var(--sakura-50);
            border-radius: 3px;
        }
        .poi-popup-list::-webkit-scrollbar-thumb {
            background: var(--sakura-300);
            border-radius: 3px;
        }
        
        .poi-category-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px 14px;
            margin-bottom: 6px;
            background: white;
            border-radius: 14px;
            cursor: pointer;
            transition: all 0.2s;
            border: 2px solid transparent;
        }
        .poi-category-item:hover {
            background: var(--sakura-50);
            transform: translateX(4px);
        }
        .poi-category-item.selected {
            border-color: var(--sakura-400);
            background: linear-gradient(135deg, var(--sakura-50) 0%, white 100%);
        }
        
        .poi-category-icon {
            width: 40px;
            height: 40px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            flex-shrink: 0;
        }
        .poi-category-info {
            flex: 1;
        }
        .poi-category-name {
            font-family: 'Quicksand', sans-serif;
            font-size: 14px;
            font-weight: 600;
            color: var(--brown-900);
            text-transform: capitalize;
        }
        .poi-category-count {
            font-size: 11px;
            color: var(--brown-800);
            opacity: 0.6;
        }
        .poi-category-check {
            width: 24px;
            height: 24px;
            border-radius: 8px;
            border: 2px solid var(--sakura-300);
            background: white;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
        }
        .poi-category-item.selected .poi-category-check {
            background: var(--sakura-500);
            border-color: var(--sakura-500);
            color: white;
        }

        /* Route info badge */
        .route-badge {
            position: fixed;
            bottom: 30px;
            left: 20px;
            display: flex;
            align-items: center;
            gap: 16px;
            padding: 12px 20px;
            background: white;
            border-radius: 50px;
            box-shadow: var(--shadow-medium);
            z-index: 100;
        }
        .route-badge-item {
            text-align: center;
        }
        .route-badge-value {
            font-family: 'Quicksand', sans-serif;
            font-size: 16px;
            font-weight: 700;
            color: var(--brown-900);
        }
        .route-badge-label {
            font-size: 9px;
            color: var(--brown-800);
            opacity: 0.6;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        .route-badge-divider {
            width: 1px;
            height: 30px;
            background: var(--sakura-200);
        }
    </style>
</head>
<body>
    <div class="petals-container" id="petals"></div>

    <!-- Start Page -->
    <div class="start-page" id="startPage">
        <div class="start-card">
            <div class="brand">NUST Navigator</div>
            <h1 class="start-title">Your Route is Ready</h1>
            
            <div class="route-visual">
                <div class="location-badge">
                    <div class="location-dot start">A</div>
                    <div class="location-name" title="NUST Central Library H-12">NUST Central Li...</div>
                </div>
                <div class="route-line"></div>
                <div class="location-badge">
                    <div class="location-dot end">B</div>
                    <div class="location-name" title="Concordia 2 (C2)">Concordia 2 (C2...</div>
                </div>
            </div>

            <div class="mode-badge">
                <span class="material-icons-round">directions_car</span>
                Driving
            </div>

            <div class="quick-stats">
                <div class="quick-stat">
                    <div class="quick-stat-value">1.7</div>
                    <div class="quick-stat-label">minutes</div>
                </div>
                <div class="quick-stat">
                    <div class="quick-stat-value">0.75</div>
                    <div class="quick-stat-label">km</div>
                </div>
                <div class="quick-stat">
                    <div class="quick-stat-value">+5</div>
                    <div class="quick-stat-label">m climb</div>
                </div>
            </div>

            <button class="explore-btn" onclick="showMap()">
                View on Map
                <span class="material-icons-round">map</span>
            </button>

            <div class="generated-time">December 13, 2025 ‚Ä¢ 04:21 PM</div>
        </div>
    </div>

    <!-- Map View -->
    <div class="map-view" id="mapView">
        <div id="map"></div>
        
        <!-- POI Filter Popup -->
        <div class="poi-filter-overlay" id="poiFilterOverlay" onclick="closePoiFilter()"></div>
        <div class="poi-filter-popup" id="poiFilterPopup">
            <div class="poi-popup-header">
                <button class="poi-popup-close" onclick="closePoiFilter()">
                    <span class="material-icons-round">close</span>
                </button>
                <h3><span class="material-icons-round">filter_list</span> Filter POIs</h3>
                <p>Select which points of interest to display</p>
            </div>
            <div class="poi-popup-actions">
                <button class="poi-action-btn" onclick="selectAllPois()">
                    <span class="material-icons-round">done_all</span>
                    Select All
                </button>
                <button class="poi-action-btn" onclick="selectNonePois()">
                    <span class="material-icons-round">remove_done</span>
                    Clear All
                </button>
            </div>
            <div class="poi-popup-list" id="poiCategoryList">
                <!-- Categories will be populated by JS -->
            </div>
        </div>
        
        <!-- FIXED: Left side controls group -->
        <div class="left-controls">
            <button class="control-btn" onclick="showStart()">
                <span class="material-icons-round">arrow_back</span>
                Back
            </button>
            <button class="control-btn" id="togglePoisBtn" onclick="openPoiFilter()">
                <span class="material-icons-round">place</span>
                POIs
            </button>
            
            <!-- Map Type Selector -->
            <div class="map-type-group">
                <button class="map-type-btn active" id="mapTypeRoadmap" onclick="setMapType('roadmap')">
                    <span class="material-icons-round">map</span>
                </button>
                <button class="map-type-btn" id="mapTypeSatellite" onclick="setMapType('satellite')">
                    <span class="material-icons-round">satellite_alt</span>
                </button>
                <button class="map-type-btn" id="mapTypeTerrain" onclick="setMapType('terrain')">
                    <span class="material-icons-round">terrain</span>
                </button>
                <button class="map-type-btn" id="mapTypeHybrid" onclick="setMapType('hybrid')">
                    <span class="material-icons-round">layers</span>
                </button>
            </div>
        </div>

        <!-- FIXED: Bottom route summary badge -->
        <div class="route-badge">
            <div class="route-badge-item">
                <div class="route-badge-value">1.7 min</div>
                <div class="route-badge-label">Duration</div>
            </div>
            <div class="route-badge-divider"></div>
            <div class="route-badge-item">
                <div class="route-badge-value">0.75 km</div>
                <div class="route-badge-label">Distance</div>
            </div>
            <div class="route-badge-divider"></div>
            <div class="route-badge-item">
                <div class="route-badge-value">PKR 113</div>
                <div class="route-badge-label">Fuel Cost</div>
            </div>
        </div>

        <!-- FIXED: Right panels with proper constraints -->
        <div class="panel-container">
            <!-- Algorithm Panel (most impressive, show first) -->
            <div class="panel" id="panelAlgo">
                <div class="panel-header" onclick="togglePanel('panelAlgo')">
                    <div class="panel-title">
                        <span class="material-icons-round">memory</span>
                        Algorithm
                    </div>
                    <span class="material-icons-round panel-toggle">expand_more</span>
                </div>
                <div class="panel-content">
                    <div class="algo-card">
                        <div class="algo-name">A* Search</div>
                        <div class="algo-stats">
                            <div class="algo-stat"><strong>59</strong> nodes</div>
                            <div class="algo-stat"><strong>123</strong> heap ops</div>
                            <div class="algo-stat"><strong>20.0</strong> ms</div>
                        </div>
                        
                    </div>
                </div>
            </div>

            <!-- Elevation Panel -->
            <div class="panel" id="panelElevation">
                <div class="panel-header" onclick="togglePanel('panelElevation')">
                    <div class="panel-title">
                        <span class="material-icons-round">terrain</span>
                        Elevation
                    </div>
                    <span class="material-icons-round panel-toggle">expand_more</span>
                </div>
                <div class="panel-content">
                    <div class="stats-grid">
                        <div class="stat-item">
                            <div class="stat-value" style="color:#10B981">+5</div>
                            <div class="stat-label">Climb (m)</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value" style="color:#EF4444">-12</div>
                            <div class="stat-label">Descent (m)</div>
                        </div>
                    </div>
                    <div class="elevation-chart">
                        <svg class="elevation-svg" id="elevationSvg" viewBox="0 0 280 45" preserveAspectRatio="none">
                            <defs>
                                <linearGradient id="elevationGradient" x1="0%" y1="0%" x2="0%" y2="100%">
                                    <stop offset="0%" style="stop-color:#E75480;stop-opacity:0.4" />
                                    <stop offset="100%" style="stop-color:#E75480;stop-opacity:0" />
                                </linearGradient>
                            </defs>
                        </svg>
                    </div>
                    <div class="elevation-labels">
                        <span>Start</span>
                        <span>End</span>
                    </div>
                </div>
            </div>

            <!-- POIs Panel -->
            <div class="panel" id="panelPois">
                <div class="panel-header" onclick="togglePanel('panelPois')">
                    <div class="panel-title">
                        <span class="material-icons-round">near_me</span>
                        Nearby
                    </div>
                    <span class="material-icons-round panel-toggle">expand_more</span>
                </div>
                <div class="panel-content">
                    
                <div class="poi-item">
                    <span class="poi-name">NUST Central Library</span>
                    <span class="poi-distance">38m</span>
                </div>
                <div class="poi-item">
                    <span class="poi-name">NUST Main Office</span>
                    <span class="poi-distance">42m</span>
                </div>
                <div class="poi-item">
                    <span class="poi-name">Central Library Parking</span>
                    <span class="poi-distance">75m</span>
                </div>
                <div class="poi-item">
                    <span class="poi-name">Central Library Cafe</span>
                    <span class="poi-distance">106m</span>
                </div>
                </div>
            </div>

            <!-- Fun Stats Panel -->
            <div class="panel" id="panelFun">
                <div class="panel-header" onclick="togglePanel('panelFun')">
                    <div class="panel-title">
                        <span class="material-icons-round">emoji_events</span>
                        Fun Facts
                    </div>
                    <span class="material-icons-round panel-toggle">expand_more</span>
                </div>
                <div class="panel-content">
                    <div class="fun-stat">üèà Distance equals 7.5 football fields</div><div class="fun-stat">üêã That's 25 blue whales lined up</div><div class="fun-stat">üè¢ You'll climb 2 floors of elevation</div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const routeCoords = [{"lat": 33.6423003, "lng": 72.9927604}, {"lat": 33.6417895, "lng": 72.9931638}, {"lat": 33.6422844, "lng": 72.9936709}, {"lat": 33.6422318, "lng": 72.9938169}, {"lat": 33.6422097, "lng": 72.9938968}, {"lat": 33.6421675, "lng": 72.9938706}, {"lat": 33.6412505, "lng": 72.9919121}, {"lat": 33.642093, "lng": 72.9894086}, {"lat": 33.6421698, "lng": 72.9892384}, {"lat": 33.6425694, "lng": 72.9881898}];
        const elevations = [563.8616943359375, 563.0277099609375, 562.4993286132812, 561.8953247070312, 561.7997436523438, 561.6681518554688, 552.3377075195312, 553.569580078125, 553.9098510742188, 557.2359619140625];
        const startCoord = {"lat": 33.6423003, "lng": 72.9927604};
        const endCoord = {"lat": 33.6425694, "lng": 72.9881898};
        const alternativeRoutes = [];
        const multiStopSegments = [];
        const waypoints = [];
        const poiData = [{"name": "NUST Central Library", "lat": 33.642042021205285, "lng": 72.99248510216118, "type": "library", "distance_m": 38.437048190146946}, {"name": "NUST Main Office", "lat": 33.642541123666454, "lng": 72.9931103622843, "type": "landmark", "distance_m": 42.11701981796051}, {"name": "Central Library Parking", "lat": 33.641655628035586, "lng": 72.99252228104255, "type": "parking", "distance_m": 74.90684441937276}, {"name": "Central Library Cafe", "lat": 33.641822473106764, "lng": 72.99176767875569, "type": "cafe", "distance_m": 106.4737669125245}, {"name": "NG cafe", "lat": 33.6417485, "lng": 72.9937372, "type": "cafe", "distance_m": 109.56221811333097}, {"name": "NUST Concordia 3 H-12", "lat": 33.642549443108145, "lng": 72.99395104292344, "type": "hostel", "distance_m": 114.13097508779903}, {"name": "NUST Auditorium", "lat": 33.643292864332274, "lng": 72.9932544098931, "type": "landmark", "distance_m": 119.37002721379098}, {"name": "NUST NIPCONS Building H-12", "lat": 33.643351692773535, "lng": 72.99319388774182, "type": "academic", "distance_m": 123.4714978591956}, {"name": "NUST Sports Complex H-12", "lat": 33.641254998940184, "lng": 72.99452086684339, "type": "sports", "distance_m": 200.66875887726286}, {"name": "SEECS Faculty Block", "lat": 33.642959721439844, "lng": 72.9907279973247, "type": "landmark", "distance_m": 202.69115918581682}];
        
        // Colors for multi-stop route segments
        const segmentColors = ['#E75480', '#10B981', '#F59E0B', '#8B5CF6', '#EC4899', '#06B6D4'];

        let map, routePolyline, altPolylines = [], poiMarkers = [], segmentPolylines = [], waypointMarkers = [];
        let poisVisible = false;

        function createPetals() {
            const container = document.getElementById('petals');
            for (let i = 0; i < 25; i++) {
                const petal = document.createElement('div');
                petal.className = 'petal';
                petal.style.left = Math.random() * 100 + 'vw';
                petal.style.animationDuration = (Math.random() * 6 + 10) + 's';
                petal.style.animationDelay = (Math.random() * 15) + 's';
                container.appendChild(petal);
            }
        }
        createPetals();

        function showMap() {
            document.getElementById('startPage').classList.add('hidden');
            document.getElementById('mapView').classList.add('active');
            setTimeout(initMap, 300);
        }

        function showStart() {
            document.getElementById('startPage').classList.remove('hidden');
            document.getElementById('mapView').classList.remove('active');
        }

        function togglePanel(id) {
            document.getElementById(id).classList.toggle('collapsed');
        }

        // POI Filter System
        const poiStyles = {
            'fuel': { color: '#EF4444', icon: '‚õΩ', bg: '#FEE2E2' },
            'restaurant': { color: '#F97316', icon: 'üçΩÔ∏è', bg: '#FFEDD5' },
            'fast_food': { color: '#FBBF24', icon: 'üçî', bg: '#FEF3C7' },
            'cafe': { color: '#A16207', icon: '‚òï', bg: '#FEF3C7' },
            'university': { color: '#8B5CF6', icon: 'üéì', bg: '#EDE9FE' },
            'library': { color: '#3B82F6', icon: 'üìö', bg: '#DBEAFE' },
            'parking': { color: '#6B7280', icon: 'üÖøÔ∏è', bg: '#F3F4F6' },
            'hospital': { color: '#DC2626', icon: 'üè•', bg: '#FEE2E2' },
            'pharmacy': { color: '#10B981', icon: 'üíä', bg: '#D1FAE5' },
            'bank': { color: '#059669', icon: 'üè¶', bg: '#D1FAE5' },
            'atm': { color: '#14B8A6', icon: 'üí≥', bg: '#CCFBF1' },
            'hotel': { color: '#EC4899', icon: 'üè®', bg: '#FCE7F3' },
            'mosque': { color: '#22C55E', icon: 'üïå', bg: '#DCFCE7' },
            'police': { color: '#1E40AF', icon: 'üëÆ', bg: '#DBEAFE' },
            'marketplace': { color: '#F59E0B', icon: 'üõí', bg: '#FEF3C7' },
            'landmark': { color: '#8B5CF6', icon: 'üèõÔ∏è', bg: '#EDE9FE' },
            'default': { color: '#F59E0B', icon: 'üìç', bg: '#FEF3C7' }
        };
        
        let selectedCategories = new Set();
        let poiByCategory = {};
        
        function initPoiCategories() {
            // Group POIs by category
            poiByCategory = {};
            poiData.forEach((poi, idx) => {
                const cat = poi.type || 'default';
                if (!poiByCategory[cat]) poiByCategory[cat] = [];
                poiByCategory[cat].push(idx);
            });
            
            // Select all categories by default
            selectedCategories = new Set(Object.keys(poiByCategory));
            
            // Build category list UI
            const listEl = document.getElementById('poiCategoryList');
            listEl.innerHTML = '';
            
            Object.keys(poiByCategory).sort().forEach(cat => {
                const style = poiStyles[cat] || poiStyles['default'];
                const count = poiByCategory[cat].length;
                
                const item = document.createElement('div');
                item.className = 'poi-category-item selected';
                item.dataset.category = cat;
                item.onclick = () => toggleCategory(cat);
                
                item.innerHTML = `
                    <div class="poi-category-icon" style="background: ${style.bg}">
                        ${style.icon}
                    </div>
                    <div class="poi-category-info">
                        <div class="poi-category-name">${cat.replace('_', ' ')}</div>
                        <div class="poi-category-count">${count} location${count !== 1 ? 's' : ''}</div>
                    </div>
                    <div class="poi-category-check">
                        <span class="material-icons-round" style="font-size: 16px;">check</span>
                    </div>
                `;
                
                listEl.appendChild(item);
            });
        }
        
        function toggleCategory(cat) {
            if (selectedCategories.has(cat)) {
                selectedCategories.delete(cat);
            } else {
                selectedCategories.add(cat);
            }
            updateCategoryUI();
            applyPoiFilter();
        }
        
        function selectAllPois() {
            selectedCategories = new Set(Object.keys(poiByCategory));
            updateCategoryUI();
            applyPoiFilter();
        }
        
        function selectNonePois() {
            selectedCategories.clear();
            updateCategoryUI();
            applyPoiFilter();
        }
        
        function updateCategoryUI() {
            document.querySelectorAll('.poi-category-item').forEach(item => {
                const cat = item.dataset.category;
                if (selectedCategories.has(cat)) {
                    item.classList.add('selected');
                } else {
                    item.classList.remove('selected');
                }
            });
            
            // Update main button state
            const anyVisible = selectedCategories.size > 0;
            document.getElementById('togglePoisBtn').classList.toggle('active', anyVisible);
        }
        
        function applyPoiFilter() {
            poiMarkers.forEach((marker, idx) => {
                const poi = poiData[idx];
                const cat = poi.type || 'default';
                marker.setVisible(selectedCategories.has(cat));
            });
        }
        
        function openPoiFilter() {
            document.getElementById('poiFilterOverlay').classList.add('active');
            document.getElementById('poiFilterPopup').classList.add('active');
        }
        
        function closePoiFilter() {
            document.getElementById('poiFilterOverlay').classList.remove('active');
            document.getElementById('poiFilterPopup').classList.remove('active');
        }

        function togglePOIs() {
            poisVisible = !poisVisible;
            document.getElementById('togglePoisBtn').classList.toggle('active', poisVisible);
            poiMarkers.forEach(m => m.setVisible(poisVisible));
        }

        function setMapType(type) {
            if (!map) return;
            
            // Update button states
            document.querySelectorAll('.map-type-btn').forEach(btn => btn.classList.remove('active'));
            document.getElementById('mapType' + type.charAt(0).toUpperCase() + type.slice(1)).classList.add('active');
            
            // Set map type
            map.setMapTypeId(google.maps.MapTypeId[type.toUpperCase()]);
            
            // Adjust route styling for satellite/hybrid views
            if (type === 'satellite' || type === 'hybrid') {
                routePolyline.setOptions({ strokeColor: '#FF69B4', strokeWeight: 6, strokeOpacity: 1.0 });
            } else {
                routePolyline.setOptions({ strokeColor: '#E75480', strokeWeight: 5, strokeOpacity: 1.0 });
            }
        }

        function initMap() {
            if (map) return;

            map = new google.maps.Map(document.getElementById('map'), {
                zoom: 15,
                center: { lat: (startCoord.lat + endCoord.lat) / 2, lng: (startCoord.lng + endCoord.lng) / 2 },
                mapTypeId: google.maps.MapTypeId.ROADMAP,
                styles: [
                    { featureType: "poi", stylers: [{ visibility: "simplified" }] },
                    { featureType: "poi.business", stylers: [{ visibility: "off" }] },
                    { featureType: "transit", stylers: [{ visibility: "simplified" }] },
                    { featureType: "water", stylers: [{ color: "#E0F2FE" }] },
                    { featureType: "landscape", stylers: [{ color: "#FAFAFA" }] },
                    { featureType: "road", elementType: "geometry", stylers: [{ color: "#FFFFFF" }] },
                    { featureType: "road", elementType: "geometry.stroke", stylers: [{ color: "#E5E7EB" }] },
                    { featureType: "road", elementType: "labels.text.fill", stylers: [{ color: "#6B7280" }] },
                    { featureType: "road.highway", elementType: "geometry", stylers: [{ color: "#FFE4E1" }] },
                    { featureType: "road.highway", elementType: "geometry.stroke", stylers: [{ color: "#FFB6C1" }] }
                ],
                disableDefaultUI: false,
                zoomControl: true,
                zoomControlOptions: { position: google.maps.ControlPosition.LEFT_BOTTOM },
                mapTypeControl: false,
                streetViewControl: true,
                streetViewControlOptions: { position: google.maps.ControlPosition.LEFT_BOTTOM },
                fullscreenControl: true,
                fullscreenControlOptions: { position: google.maps.ControlPosition.TOP_LEFT },
                scaleControl: true,
                rotateControl: true
            });

            // Check if multi-stop route
            if (multiStopSegments && multiStopSegments.length > 0) {
                // Draw each segment with a different color
                multiStopSegments.forEach((segment, idx) => {
                    const color = segmentColors[idx % segmentColors.length];
                    const segPoly = new google.maps.Polyline({
                        path: segment,
                        geodesic: true,
                        strokeColor: color,
                        strokeOpacity: 1.0,
                        strokeWeight: 6,
                        map: map
                    });
                    segmentPolylines.push(segPoly);
                });
                
                // Draw waypoint markers with numbers
                waypoints.forEach((wp, idx) => {
                    const label = idx === 0 ? 'S' : idx.toString();
                    const color = idx === 0 ? '#10B981' : segmentColors[(idx - 1) % segmentColors.length];
                    createMarker(wp.coord, label, color, wp.label);
                });
            } else {
                // Single route - draw normally
                routePolyline = new google.maps.Polyline({
                    path: routeCoords,
                    geodesic: true,
                    strokeColor: '#E75480',
                    strokeOpacity: 1.0,
                    strokeWeight: 5,
                    map: map
                });

                // Alternative routes
                alternativeRoutes.forEach((alt, idx) => {
                    const altPoly = new google.maps.Polyline({
                        path: alt.coords,
                        geodesic: true,
                        strokeColor: '#9CA3AF',
                        strokeOpacity: 0.5,
                        strokeWeight: 4,
                        map: map
                    });
                    altPolylines.push(altPoly);
                });

                // Markers for single route
                createMarker(startCoord, 'A', '#10B981');
                createMarker(endCoord, 'B', '#E75480');
            }

            // Fit bounds with padding for panels
            const bounds = new google.maps.LatLngBounds();
            routeCoords.forEach(c => bounds.extend(c));
            map.fitBounds(bounds, { top: 50, right: 340, bottom: 100, left: 50 });

            // Create POI markers (visible by default since all categories selected)
            poiData.forEach((poi, idx) => {
                if (poi.lat && poi.lng) {
                    const style = poiStyles[poi.type] || poiStyles['default'];
                    const marker = new google.maps.Marker({
                        position: { lat: poi.lat, lng: poi.lng },
                        map: map,
                        visible: true,  // All visible by default
                        icon: {
                            path: google.maps.SymbolPath.BACKWARD_CLOSED_ARROW,
                            scale: 6,
                            fillColor: style.color,
                            fillOpacity: 0.9,
                            strokeColor: '#FFFFFF',
                            strokeWeight: 2
                        },
                        title: poi.name + ' (' + poi.type + ')'
                    });
                    
                    const infoWindow = new google.maps.InfoWindow({
                        content: `<div style="font-family: 'Quicksand', sans-serif; padding: 8px;">
                            <span style="font-size: 20px;">${style.icon}</span>
                            <strong style="color: ${style.color}">${poi.name}</strong><br>
                            <span style="color: #6B7280; font-size: 12px; text-transform: capitalize;">${poi.type ? poi.type.replace('_', ' ') : 'Location'}</span><br>
                            <span style="color: #10B981; font-size: 11px;">${poi.distance_m ? (poi.distance_m / 1000).toFixed(2) + ' km away' : ''}</span>
                        </div>`
                    });
                    marker.addListener('click', () => infoWindow.open(map, marker));
                    
                    poiMarkers.push(marker);
                }
            });

            // Initialize POI category filter
            initPoiCategories();
            document.getElementById('togglePoisBtn').classList.add('active');

            drawElevationChart();
        }

        function createMarker(coord, label, color, title = '') {
            const marker = new google.maps.Marker({
                position: coord,
                map: map,
                label: { text: label, color: 'white', fontWeight: 'bold', fontSize: '14px' },
                icon: {
                    path: google.maps.SymbolPath.CIRCLE,
                    scale: 16,
                    fillColor: color,
                    fillOpacity: 1,
                    strokeColor: 'white',
                    strokeWeight: 3
                },
                title: title
            });
            
            // Add info window for multi-stop waypoints
            if (title) {
                const infoWindow = new google.maps.InfoWindow({
                    content: `<div style="font-family: 'Quicksand', sans-serif; padding: 8px;">
                        <strong style="color: ${color}">${label === 'S' ? 'Start' : 'Stop ' + label}</strong><br>
                        <span>${title}</span>
                    </div>`
                });
                marker.addListener('click', () => infoWindow.open(map, marker));
            }
            
            return marker;
        }

        function drawElevationChart() {
            if (elevations.length < 2) return;

            const svg = document.getElementById('elevationSvg');
            const width = 280;
            const height = 45;
            const padTop = 5;
            const padBottom = 5;

            const minElev = Math.min(...elevations);
            const maxElev = Math.max(...elevations);
            const elevRange = maxElev - minElev || 1;

            let pathD = 'M ';
            let fillD = `M 0 ${height} L `;

            elevations.forEach((elev, i) => {
                const x = (i / (elevations.length - 1)) * width;
                const y = height - padBottom - ((elev - minElev) / elevRange) * (height - padTop - padBottom);
                pathD += `${x},${y} `;
                fillD += `${x},${y} `;
            });

            fillD += `L ${width} ${height} Z`;

            const fillEl = document.createElementNS('http://www.w3.org/2000/svg', 'path');
            fillEl.setAttribute('d', fillD);
            fillEl.setAttribute('class', 'elevation-fill');
            svg.appendChild(fillEl);

            const pathEl = document.createElementNS('http://www.w3.org/2000/svg', 'path');
            pathEl.setAttribute('d', pathD);
            pathEl.setAttribute('class', 'elevation-path');
            svg.appendChild(pathEl);
        }
    </script>
</body>
</html>